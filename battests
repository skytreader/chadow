# vim: set ft=sh:

py="/home/$(whoami)/.virtualenvs/chadow/bin/python"

setup() {
    ./install
    source ~/.venvburrito/bin/virtualenvwrapper.sh
    # NOTE: Do not use `workon`; it fails for some damn reason.
    sh ~/.virtualenvs/chadow/bin/activate
}

@test "that config.json exists after setup" {
    ls ~/.chadow/config.json
    config_ver=`jq .version ~/.chadow/config.json | sed 's/"//g'`
    repo_ver=`head -n 1 VERSION`
    [ "$config_ver" == "$repo_ver" ]
}

@test "that createlib works as expected" {
    $py chadow.py createlib test1
    library_sectors=`jq .libraries.test1.sectors ~/.chadow/config.json`
    [ "$library_sectors" == "{}" ]
}

@test "that deletelib works as expected" {
    $py chadow.py createlib test1
    library_sectors=`jq .libraries.test1.sectors ~/.chadow/config.json`
    [ "$library_sectors" == "{}" ]
    $py chadow.py deletelib test1
    libraries=`jq .libraries ~/.chadow/config.json`
    [ "$libraries" == "{}" ]
}

teardown() {
    ./uninstall
}
